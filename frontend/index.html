<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QazStep ‚Äî –ò–∑—É—á–µ–Ω–∏–µ –∫–∞–∑–∞—Ö—Å–∫–æ–≥–æ —è–∑—ã–∫–∞</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Dictionary Preview Styles */
        .dictionary-preview {
            padding: 80px 0;
            background: var(--color-light);
        }

        .preview-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .category-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--shadow-soft);
            transition: transform var(--transition-base);
        }

        .category-card:hover {
            transform: translateY(-5px);
        }

        .category-card i {
            font-size: 2.5rem;
            color: var(--color-primary);
            margin-bottom: 15px;
        }

        .category-card h3 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .category-card p {
            color: var(--color-text);
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .category-card .btn {
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
        }
    </style>
</head>
<body data-page="landing">
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div class="notification-container" id="notificationContainer"></div>

    <header class="site-header">
        <div class="container header__content">
            <a class="logo" href="index.html">QazStep</a>
            <nav class="primary-nav" aria-label="–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é">
                <ul class="nav-list">
                    <li><a class="nav-link" href="lessons.html">–£—Ä–æ–∫–∏</a></li>
                    <li><a class="nav-link" href="theory.html">–¢–µ–æ—Ä–∏—è</a></li>
                    <li><a class="nav-link" href="dictionary.html">–°–ª–æ–≤–∞—Ä—å</a></li>
                    <li><a class="nav-link" href="admin-dashboard.html">–ê–¥–º–∏–Ω</a></li>
                </ul>
            </nav>
            <div class="auth-buttons" id="authButtons">
                <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            <button class="hamburger" aria-label="–û—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero__decor hero__decor--one"></div>
            <div class="hero__decor hero__decor--two"></div>
            <div class="container hero__glass">
                <span class="hero__badge badge">
                    <i class="fa-solid fa-sparkles"></i>
                    –ò–∑—É—á–∞–π –∫–∞–∑–∞—Ö—Å–∫–∏–π —à–∞–≥ –∑–∞ —à–∞–≥–æ–º
                </span>
                <div class="hero__grid">
                    <div class="hero__content">
                        <p class="hero__eyebrow">–ö–∞–∑–∞—Ö—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è —É—Ä–æ–≤–Ω–µ–π A1‚ÄìB2</p>
                        <h1>–ö–∞–∑–∞—Ö—Å–∫–∏–π —è–∑—ã–∫: –æ—Ç —Å–ª–æ–≤ –∫ —Å–≤–æ–±–æ–¥–µ –æ–±—â–µ–Ω–∏—è</h1>
                        <p class="hero__description">
                            –ü–æ—à–∞–≥–æ–≤—ã–µ —É—Ä–æ–∫–∏ –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É. –ù–∞—á–Ω–∏ —Å –æ—Å–Ω–æ–≤ –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏ –∫ —Å–≤–æ–±–æ–¥–Ω–æ–º—É –æ–±—â–µ–Ω–∏—é.
                        </p>
                        <div class="hero__actions">
                            <a href="lessons.html" class="btn btn--primary">
                                <span>–ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ</span>
                                <i class="fa-solid fa-arrow-right"></i>
                            </a>
                            <a href="theory.html" class="btn btn--secondary">
                                <i class="fa-solid fa-book"></i>
                                <span>–¢–µ–æ—Ä–∏—è</span>
                            </a>
                        </div>
                        <ul class="hero__meta" aria-label="–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞">
                            <li>
                                <strong>–ü–æ—à–∞–≥–æ–≤–æ</strong>
                                –û—Ç A1 –¥–æ B2
                            </li>
                            <li>
                                <strong>–ü—Ä–∞–∫—Ç–∏–∫–∞</strong>
                                –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è
                            </li>
                            <li>
                                <strong>–ü—Ä–æ–≥—Ä–µ—Å—Å</strong>
                                –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                            </li>
                        </ul>
                    </div>
                    <div class="hero__visual">
                        <div class="hero-illustration">
                            <div class="hero-illustration__shape hero-illustration__shape--primary"></div>
                            <div class="hero-illustration__shape hero-illustration__shape--secondary"></div>
                            <div class="hero-illustration__card card card--glass card--levels">
                                <p>–í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
                                <div class="progress">
                                    <div class="progress__fill" id="overallProgress"></div>
                                </div>
                                <p id="progressText">0% –∑–∞–≤–µ—Ä—à–µ–Ω–æ</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lessons Section -->
        <section class="preview-lessons" id="lessons">
            <div class="container preview-lessons__inner">
                <div class="section-header preview-lessons__header">
                    <p class="section-header__eyebrow">–ü–æ—à–∞–≥–æ–≤—ã–µ —É—Ä–æ–∫–∏</p>
                    <h2>–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ –∏ –¥–≤–∏–≥–∞–π—Ç–µ—Å—å –¥–∞–ª—å—à–µ</h2>
                    <p class="section-header__subtitle">–í—Å–µ —É—Ä–æ–∫–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤ –ø–æ—Ä—è–¥–∫–µ –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ —Å–ª–æ–∂–Ω–æ–º—É</p>
                </div>

                <div class="lessons-sequence" id="lessonsSequence">
                    <!-- –£—Ä–æ–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ JS -->
                    <div class="loading-lessons">
                        <i class="fa-solid fa-spinner fa-spin"></i>
                        <p>–ó–∞–≥—Ä—É–∑–∫–∞ —É—Ä–æ–∫–æ–≤...</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <a href="lessons.html" class="btn btn--secondary">
                        <i class="fa-solid fa-list"></i>
                        –í—Å–µ —É—Ä–æ–∫–∏
                    </a>
                </div>
            </div>
        </section>

        <!-- Theory Section -->
        <section class="theory-section" id="theory">
            <div class="container">
                <div class="section-header">
                    <p class="section-header__eyebrow">–°–ø—Ä–∞–≤–æ—á–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã</p>
                    <h2>–¢–µ–æ—Ä–∏—è –¥–ª—è –∑–∞–∫—Ä–µ–ø–ª–µ–Ω–∏—è</h2>
                    <p class="section-header__subtitle">–ò–∑—É—á–∞–π—Ç–µ –≥—Ä–∞–º–º–∞—Ç–∏–∫—É –∏ –ª–µ–∫—Å–∏–∫—É –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —É—Ä–æ–∫–∞–º–∏</p>
                </div>

                <div class="theory-grid" id="theoryGrid">
                    <!-- –¢–µ–æ—Ä–∏–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="loading-theories">
                        <i class="fa-solid fa-book-open"></i>
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã...</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <a href="theory.html" class="btn btn--primary">
                        <i class="fa-solid fa-book"></i>
                        –í—Å—è —Ç–µ–æ—Ä–∏—è
                    </a>
                </div>
            </div>
        </section>

        <!-- Dictionary Section -->
        <section class="dictionary-preview" id="dictionary">
            <div class="container">
                <div class="section-header">
                    <p class="section-header__eyebrow">–°–ª–æ–≤–∞—Ä—å</p>
                    <h2>–ò–∑—É—á–∞–π—Ç–µ —Å–ª–æ–≤–∞ –ø–æ —Ç–µ–º–∞–º</h2>
                    <p class="section-header__subtitle">–ë–æ–ª–µ–µ 1000 —Å–ª–æ–≤ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –æ–∑–≤—É—á–∫–æ–π</p>
                </div>

                <div class="preview-categories">
                    <div class="category-card">
                        <i class="fa-solid fa-handshake"></i>
                        <h3>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è</h3>
                        <p>50 —Å–ª–æ–≤</p>
                        <a href="dictionary.html?category=greetings" class="btn btn--secondary">–ò–∑—É—á–∏—Ç—å</a>
                    </div>
                    <div class="category-card">
                        <i class="fa-solid fa-utensils"></i>
                        <h3>–ï–¥–∞</h3>
                        <p>120 —Å–ª–æ–≤</p>
                        <a href="dictionary.html?category=food" class="btn btn--secondary">–ò–∑—É—á–∏—Ç—å</a>
                    </div>
                    <div class="category-card">
                        <i class="fa-solid fa-house"></i>
                        <h3>–°–µ–º—å—è</h3>
                        <p>80 —Å–ª–æ–≤</p>
                        <a href="dictionary.html?category=family" class="btn btn--secondary">–ò–∑—É—á–∏—Ç—å</a>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 40px;">
                    <a href="dictionary.html" class="btn btn--primary">
                        <i class="fa-solid fa-book"></i>
                        –í–µ—Å—å —Å–ª–æ–≤–∞—Ä—å
                    </a>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer">
        <div class="container footer__inner">
            <div class="footer__brand">
                <a class="logo" href="index.html">QazStep</a>
                <p>–®–∞–≥ –∑–∞ —à–∞–≥–æ–º –∫ —Å–≤–æ–±–æ–¥–Ω–æ–º—É –≤–ª–∞–¥–µ–Ω–∏—é –∫–∞–∑–∞—Ö—Å–∫–∏–º —è–∑—ã–∫–æ–º.</p>
                <div class="footer__socials">
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-youtube"></i></a>
                    <a href="#"><i class="fa-brands fa-telegram"></i></a>
                </div>
            </div>
            <div class="footer__links">
                <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
                <ul>
                    <li><a href="lessons.html">–£—Ä–æ–∫–∏</a></li>
                    <li><a href="theory.html">–¢–µ–æ—Ä–∏—è</a></li>
                    <li><a href="dictionary.html">–°–ª–æ–≤–∞—Ä—å</a></li>
                    <li><a href="admin-dashboard.html">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a></li>
                </ul>
            </div>
            <div class="footer__contacts">
                <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                <ul>
                    <li><i class="fa-solid fa-envelope"></i> <a href="mailto:hello@qazstep.kz">hello@qazstep.kz</a></li>
                    <li><i class="fa-solid fa-location-dot"></i> –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω</li>
                </ul>
            </div>
        </div>
        <div class="footer__bottom">
            <p>¬© 2024 QazStep. –®–∞–≥ –∑–∞ —à–∞–≥–æ–º –∫ –∑–Ω–∞–Ω–∏—è–º.</p>
        </div>
    </footer>

    <script>
    // ====================
    // API –î–õ–Ø –†–ê–ë–û–¢–´ –° –°–ï–†–í–ï–†–û–ú
    // ====================
    const API_URL = 'http://localhost:3000/api';

    class QazStepAPI {
        // üìå –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        static async checkConnection() {
            try {
                const response = await fetch(`${API_URL}/status`);
                return response.ok;
            } catch {
                return false;
            }
        }

        // üìå –£—Ä–æ–∫–∏
        static async getLessons() {
            try {
                const response = await fetch(`${API_URL}/lessons`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤');
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
                return JSON.parse(localStorage.getItem('qazstep_lessons') || '[]');
            }
        }

        static async saveLesson(lesson) {
            try {
                const method = lesson.id ? 'PUT' : 'POST';
                const url = lesson.id ? `${API_URL}/lessons/${lesson.id}` : `${API_URL}/lessons`;

                const response = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(lesson)
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Ä–æ–∫–∞');
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É—Ä–æ–∫–∞:', error);
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                const lessons = JSON.parse(localStorage.getItem('qazstep_lessons') || '[]');
                if (lesson.id) {
                    const index = lessons.findIndex(l => l.id === lesson.id);
                    if (index !== -1) {
                        lessons[index] = lesson;
                    }
                } else {
                    lessons.push(lesson);
                }
                localStorage.setItem('qazstep_lessons', JSON.stringify(lessons));
                return lesson;
            }
        }

        // üìå –¢–µ–æ—Ä–∏–∏
        static async getTheories() {
            try {
                const response = await fetch(`${API_URL}/theories`);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–π');
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–π:', error);
                return JSON.parse(localStorage.getItem('qazstep_theories') || '[]');
            }
        }

        static async saveTheory(theory) {
            try {
                const method = theory.id ? 'PUT' : 'POST';
                const url = theory.id ? `${API_URL}/theories/${theory.id}` : `${API_URL}/theories`;

                const response = await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(theory)
                });

                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–æ—Ä–∏–∏');
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–æ—Ä–∏–∏:', error);
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                const theories = JSON.parse(localStorage.getItem('qazstep_theories') || '[]');
                if (theory.id) {
                    const index = theories.findIndex(t => t.id === theory.id);
                    if (index !== -1) {
                        theories[index] = theory;
                    }
                } else {
                    theories.push(theory);
                }
                localStorage.setItem('qazstep_theories', JSON.stringify(theories));
                return theory;
            }
        }

        // üìå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
        static async getUsers() {
            try {
                const response = await fetch(`${API_URL}/users`);
                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                return JSON.parse(localStorage.getItem('qazstep_users') || '[]');
            }
        }

        static async login(credentials) {
            try {
                const response = await fetch(`${API_URL}/users/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(credentials)
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error);
                }

                return await response.json();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                throw error;
            }
        }

        // üìå –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã (–ø–æ–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ)
        static async getUploadedFiles() {
            return JSON.parse(localStorage.getItem('qazstep_uploadedFiles') || '[]');
        }

        // üìå –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
        static async addRecentAction(action, type = 'system') {
            const actions = JSON.parse(localStorage.getItem('qazstep_recentActions') || '[]');
            const user = JSON.parse(localStorage.getItem('qazstep_session'));

            const newAction = {
                id: Date.now(),
                action: action,
                type: type,
                user: user ? user.name : 'system',
                timestamp: new Date().toISOString(),
                time: new Date().toLocaleTimeString('ru-RU')
            };

            actions.unshift(newAction);
            if (actions.length > 50) {
                actions.pop();
            }

            localStorage.setItem('qazstep_recentActions', JSON.stringify(actions));
            return newAction;
        }
    }

    // ====================
    // –û–°–ù–û–í–ù–û–ô –°–ö–†–ò–ü–¢ –î–õ–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´
    // ====================

    document.addEventListener("DOMContentLoaded", async function() {
        console.log("–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞");

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        await initDatabase();
        updateAuthUI();
        setupHamburgerMenu();

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        await loadLessonsForHome();
        await loadTheoriesForHome();
        await updateProgress();
    });

    async function initDatabase() {
        console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö...");

        try {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
            const isConnected = await QazStepAPI.checkConnection();
            console.log("–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º:", isConnected ? "‚úì –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ" : "‚úó –ù–µ—Ç —Å–≤—è–∑–∏");

            if (isConnected) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
                const [users, lessons, theories] = await Promise.all([
                    QazStepAPI.getUsers(),
                    QazStepAPI.getLessons(),
                    QazStepAPI.getTheories()
                ]);

                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –∫—ç—à
                localStorage.setItem('qazstep_users', JSON.stringify(users));
                localStorage.setItem('qazstep_lessons', JSON.stringify(lessons));
                localStorage.setItem('qazstep_theories', JSON.stringify(theories));

                console.log(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Å —Å–µ—Ä–≤–µ—Ä–∞: ${users.length} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, ${lessons.length} —É—Ä–æ–∫–æ–≤, ${theories.length} —Ç–µ–æ—Ä–∏–π`);
            } else {
                console.log('–†–∞–±–æ—Ç–∞–µ–º –≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–º —Ä–µ–∂–∏–º–µ (localStorage)');
                initLocalStorage();
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å —Å–µ—Ä–≤–µ—Ä–∞:', error);
            initLocalStorage();
        }
    }

    function initLocalStorage() {
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
        if (!localStorage.getItem('qazstep_users')) {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π");
            localStorage.setItem('qazstep_users', JSON.stringify([]));
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç —É—Ä–æ–∫–æ–≤ - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
        if (!localStorage.getItem('qazstep_lessons')) {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É —É—Ä–æ–∫–æ–≤");
            localStorage.setItem('qazstep_lessons', JSON.stringify([]));
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç —Ç–µ–æ—Ä–∏–π - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
        if (!localStorage.getItem('qazstep_theories')) {
            console.log("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–∞–∑—É —Ç–µ–æ—Ä–∏–π");
            localStorage.setItem('qazstep_theories', JSON.stringify([]));
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
        if (!localStorage.getItem('qazstep_uploadedFiles')) {
            localStorage.setItem('qazstep_uploadedFiles', JSON.stringify([]));
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º
        if (!localStorage.getItem('qazstep_recentActions')) {
            localStorage.setItem('qazstep_recentActions', JSON.stringify([]));
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UI –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    function updateAuthUI() {
        const authButtons = document.getElementById('authButtons');
        if (!authButtons) return;

        const session = localStorage.getItem('qazstep_session');
        let user = null;

        if (session) {
            try {
                user = JSON.parse(session);
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å–µ—Å—Å–∏–∏:", e);
            }
        }

        if (user) {
            authButtons.innerHTML = `
                <div class="user-menu">
                    <span class="user-greeting">
                        <i class="fa-solid fa-user"></i>
                        ${user.name}
                    </span>
                    <button onclick="logout()" class="btn btn--small btn--secondary">
                        –í—ã–π—Ç–∏
                    </button>
                </div>
            `;
        } else {
            authButtons.innerHTML = `
                <div class="auth-buttons">
                    <a href="login.html" class="btn btn--secondary btn--small">
                        –í—Ö–æ–¥
                    </a>
                    <a href="register.html" class="btn btn--primary btn--small">
                        –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                    </a>
                </div>
            `;
        }
    }

    // –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
    async function logout() {
        const session = localStorage.getItem('qazstep_session');
        let user = null;

        if (session) {
            try {
                user = JSON.parse(session);
            } catch (e) {
                console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ —Å–µ—Å—Å–∏–∏:", e);
            }
        }

        if (user) {
            await QazStepAPI.addRecentAction(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${user.name} –≤—ã—à–µ–ª –∏–∑ —Å–∏—Å—Ç–µ–º—ã`, 'user');
        }
        localStorage.removeItem('qazstep_session');
        showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã', 'success');
        setTimeout(() => {
            updateAuthUI();
            window.location.href = 'index.html';
        }, 1000);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–µ–Ω—é
    function setupHamburgerMenu() {
        const hamburger = document.querySelector('.hamburger');
        const nav = document.querySelector('.primary-nav');

        if (hamburger && nav) {
            hamburger.addEventListener('click', () => {
                nav.classList.toggle('show');
                hamburger.classList.toggle('is-active');
            });

            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É
            nav.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    nav.classList.remove('show');
                    hamburger.classList.remove('is-active');
                });
            });
        }
    }

    async function loadLessonsForHome() {
        const container = document.getElementById('lessonsSequence');
        if (!container) return;

        try {
            const lessons = await QazStepAPI.getLessons();

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
            lessons.sort((a, b) => a.order - b.order);

            container.innerHTML = '';

            if (lessons.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fa-solid fa-book-open"></i>
                        <p>–£—Ä–æ–∫–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }

            lessons.slice(0, 3).forEach((lesson, index) => {
                const card = document.createElement('div');
                card.className = 'lesson-card card';
                card.innerHTML = `
                    <span class="badge level-badge level-${lesson.level.toLowerCase()}">${lesson.level}</span>
                    <div class="lesson-card__type">${getLessonTypeName(lesson.type)}</div>
                    <h3>${lesson.title}</h3>
                    <p>${lesson.description}</p>
                    ${lesson.mediaFileId ? `<div style="margin: 10px 0;">${getMediaPreview(lesson.mediaFileId)}</div>` : ''}
                    <div class="progress">
                        <div class="progress__fill" style="width: ${lesson.progress || 0}%"></div>
                    </div>
                    <a href="lesson-view.html?id=${lesson.id}" class="btn btn--primary">
                        ${(lesson.progress || 0) > 0 ? '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å' : '–ù–∞—á–∞—Ç—å'}
                    </a>
                `;
                container.appendChild(card);
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤:', error);
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—Ä–æ–∫–æ–≤</p>
                </div>
            `;
        }
    }

    async function loadTheoriesForHome() {
        const container = document.getElementById('theoryGrid');
        if (!container) return;

        try {
            const theories = await QazStepAPI.getTheories();

            container.innerHTML = '';

            if (theories.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fa-solid fa-book-open"></i>
                        <p>–¢–µ–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
                    </div>
                `;
                return;
            }

            theories.slice(0, 4).forEach(theory => {
                const card = document.createElement('div');
                card.className = 'theory-card card';
                card.innerHTML = `
                    <div class="theory-card__icon">
                        <i class="fa-solid fa-book"></i>
                    </div>
                    <span class="badge level-badge level-${theory.level.toLowerCase()}">${theory.level}</span>
                    <h3>${theory.title}</h3>
                    ${theory.imageFileId ? `<div style="margin: 10px 0;">${getMediaPreview(theory.imageFileId)}</div>` : ''}
                    <p class="theory-card__preview">${stripHtml(theory.content || '').substring(0, 100)}...</p>
                    <div style="margin-top: 15px;">
                        <button onclick="openTheory(${theory.id})" class="btn btn--secondary">
                            <i class="fa-solid fa-book-open"></i> –û—Ç–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–π:', error);
            container.innerHTML = `
                <div class="empty-state">
                    <i class="fa-solid fa-exclamation-triangle"></i>
                    <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–π</p>
                </div>
            `;
        }
    }

    async function updateProgress() {
        try {
            const lessons = await QazStepAPI.getLessons();
            const progressBar = document.getElementById('overallProgress');
            const progressText = document.getElementById('progressText');

            if (!progressBar || !progressText) return;

            if (lessons.length === 0) {
                progressBar.style.width = '0%';
                progressText.textContent = '–ù–µ—Ç —É—Ä–æ–∫–æ–≤';
                return;
            }

            const totalProgress = lessons.reduce((sum, lesson) => sum + (lesson.progress || 0), 0);
            const averageProgress = Math.round(totalProgress / lessons.length);

            progressBar.style.width = averageProgress + '%';
            progressText.textContent = averageProgress + '% –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞:', error);
        }
    }

    function getLessonTypeName(type) {
        const types = {
            'video': '–í–∏–¥–µ–æ',
            'audio': '–ê—É–¥–∏–æ',
            'theory': '–¢–µ–æ—Ä–∏—è',
            'practice': '–ü—Ä–∞–∫—Ç–∏–∫–∞'
        };
        return types[type] || type;
    }

    function stripHtml(html) {
        if (!html) return '';
        const tmp = document.createElement('div');
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || '';
    }

    async function getMediaPreview(fileId) {
        if (!fileId) return '';

        try {
            const uploadedFiles = await QazStepAPI.getUploadedFiles();
            const file = uploadedFiles.find(f => f.id.toString() === fileId.toString());

            if (!file) return '';

            if (file.type === 'image') {
                return `<img src="${file.dataUrl}" alt="${file.name}" style="max-width: 100%; max-height: 150px; border-radius: 8px; object-fit: cover;">`;
            } else if (file.type === 'video') {
                return `<div style="background: var(--color-light); padding: 20px; border-radius: 8px; text-align: center;">
                            <i class="fa-solid fa-video" style="font-size: 2rem; color: var(--color-primary); margin-bottom: 10px;"></i>
                            <p style="color: var(--color-text); font-size: 0.9rem;">–í–∏–¥–µ–æ: ${file.name}</p>
                        </div>`;
            }

            return '';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞:', error);
            return '';
        }
    }

    async function openTheory(id) {
        try {
            const theories = await QazStepAPI.getTheories();
            const theory = theories.find(t => t.id === id);

            if (!theory) {
                showNotification('–¢–µ–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                return;
            }

            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
            theory.views = (theory.views || 0) + 1;
            await QazStepAPI.saveTheory(theory);

            // –ü–æ–ª—É—á–∞–µ–º –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã
            const uploadedFiles = await QazStepAPI.getUploadedFiles();
            const imageFile = theory.imageFileId ? uploadedFiles.find(f => f.id.toString() === theory.imageFileId.toString()) : null;
            const mediaFile = theory.mediaFileId ? uploadedFiles.find(f => f.id.toString() === theory.mediaFileId.toString()) : null;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = `theoryModal-${id}`;
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${theory.title}</h3>
                        <button class="close-modal" onclick="closeModal('theoryModal-${id}')">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="theory-meta">
                            <span class="badge level-badge level-${theory.level.toLowerCase()}">${theory.level}</span>
                            <span><i class="fa-solid fa-eye"></i> ${theory.views || 0} –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</span>
                        </div>
                        ${imageFile ? `
                            <div style="margin: 20px 0;">
                                <img src="${imageFile.dataUrl}" alt="${imageFile.name}" style="max-width: 100%; border-radius: 12px; margin-bottom: 20px;">
                            </div>
                        ` : ''}
                        ${mediaFile && mediaFile !== imageFile ? `
                            <div style="margin: 20px 0;">
                                ${mediaFile.type === 'video' ?
                                    `<video controls style="max-width: 100%; border-radius: 12px;">
                                        <source src="${mediaFile.dataUrl}" type="video/mp4">
                                        –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                                    </video>` :
                                    `<img src="${mediaFile.dataUrl}" alt="${mediaFile.name}" style="max-width: 100%; border-radius: 12px;">`
                                }
                            </div>
                        ` : ''}
                        <div class="theory-content">
                            ${theory.content || '<p>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</p>'}
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn--secondary" onclick="closeModal('theoryModal-${id}')">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeModal(`theoryModal-${id}`);
                }
            });

        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ç–µ–æ—Ä–∏–∏:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–æ—Ä–∏–∏', 'error');
        }
    }

    function showNotification(message, type = 'info') {
        const container = document.getElementById('notificationContainer');
        if (!container) return;

        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        const oldNotifications = container.querySelectorAll('.notification');
        oldNotifications.forEach(n => n.remove());

        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;

        let iconClass = 'fa-info-circle';
        if (type === 'success') iconClass = 'fa-check-circle';
        if (type === 'error') iconClass = 'fa-exclamation-circle';
        if (type === 'warning') iconClass = 'fa-exclamation-triangle';

        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas ${iconClass}"></i>
                <span>${message}</span>
            </div>
            <button class="notification-close">&times;</button>
        `;

        container.appendChild(notification);

        setTimeout(() => {
            if (notification.parentNode) {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }
        }, 5000);

        notification.querySelector('.notification-close').addEventListener('click', () => {
            notification.classList.add('fade-out');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 300);
        });
    }

    function closeModal(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.remove();
        }
    }

    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
    window.openTheory = openTheory;
    window.closeModal = closeModal;
    window.logout = logout;
    </script>
</body>
</html>